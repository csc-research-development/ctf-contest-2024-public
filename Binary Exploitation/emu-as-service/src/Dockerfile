FROM ubuntu:latest

RUN apt-get update && apt-get install -y socat && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
RUN useradd -U -m -s /bin/bash ctf

COPY ./chall /home/ctf/chall
COPY ./run.sh /home/ctf/run
COPY ./flag.txt /home/ctf/flag.txt

RUN chown -R root:ctf /home/ctf && chmod -R 550 /home/ctf

CMD socat TCP-L:1337,fork EXEC:"/home/ctf/run",reuseaddr,stderr
