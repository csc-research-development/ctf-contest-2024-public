<!DOCTYPE html>
<html>
	<%- include('partials/head') %>
	<body class="bg-gray-950 flex flex-col h-screen">
		<%- include('partials/navbar') %>
		<div class="py-10">
			<h1 class="font-bold text-2xl text-center">CoinHunt Shop</h1>
			<p class="max-w-prose text-center mx-auto text-gray-300 mt-1">
				Welcome to the CoinHunt Shop! Here you can find a wide range of
				products and services to enhance your trading experience.
			</p>
		</div>

		<div class="px-5">
			<ul class="grid grid-cols-3 max-w-screen-2xl mx-auto gap-20 pb-8">
				<% items.forEach(function(item) { %>
				<li class="flex flex-col gap-2">
					<img
						src="<%= item.image %>"
						alt="<%= item.name %>"
						class="w-full h-[300px] object-cover rounded-md"
					/>

					<h2 class="font-semibold text-xl">
						<%= item.name %> <% if(user.items[item.id]){ %>
						<span
							class=""
							data-id="<%= item.id %>"
							onclick="sell(this)"
						>
							(you have <%= user.items[item.id] || 0 %>)
						</span>
						<% } %>
					</h2>
					<p class="text-gray-300"><%= item.description %></p>
					<button
						class="bg-blue-600 mt-4 hover:bg-blue-700 font-medium px-5 py-1 rounded-full"
						data-id="<%= item.id %>"
						onclick="buy(this)"
					>
						Buy ($<%= item.price.toLocaleString() %>)
					</button>

					<% if(user.items[item.id]){ %>
					<button
						class="py-1 bg-red-800 hover:bg-red-900 rounded-full w-full"
						data-id="<%= item.id %>"
						onclick="sell(this)"
					>
						Sell
					</button>
					<% } %>
				</li>
				<% }) %>
			</ul>
		</div>

		<script>
			async function buy(btn) {
				const res = await fetch(`/shops/buy/${btn.dataset.id}`, {
					method: 'POST',
				})

				const data = await res.json()

				if (!res.ok) {
					alert(data.error)
					return
				}

				alert(data.msg)
				location.reload()
			}

			async function sell(btn) {
				const res = await fetch(`/shops/sell/${btn.dataset.id}`, {
					method: 'POST',
				})

				const data = await res.json()

				if (!res.ok) {
					alert(data.error)
					return
				}

				alert(data.msg)
				location.reload()
			}
		</script>
	</body>
</html>
